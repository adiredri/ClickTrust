<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Product</title>
    <link rel="stylesheet" href="styles/AddProduct.css">
</head>
<body>

    <!-- start video, navbar, logo, widget -->

    <div class="video-background">
        <video autoplay muted loop>
            <source src="images/global2.mp4" type="video/mp4">
        </video>
    </div>
    <nav>
        <div class="nav-bar">
            <a href="Contact.html">Contact Us</a>
            <a href="About.html">About Us</a>
            <a href="AddProduct.html">Add Asset</a>
            <a href="History.html">History</a>
            <a href="SignUp.html">Log Out</a>
        </div>
    </nav>
    <div class="logo">
        <img src="images/WhiteLogo.png" alt="My Logo" class="logo">
    </div>
    <div id="widget">
        <a id="home-link" href="#"> <!-- שימו לב ל-ID החדש כאן -->
            <img src="images/homepage.png" alt="Image" id="widget-image"></a>
    </div>

        <!-- end video, navbar, logo, widget -->

        <!-- start left form -->

    <div class="container left">
        <form id="assetForm" method="POST" style="margin-top: -190px;">
            <h2>Adding New Digital Asset</h2><br>
            <input type="text" name="Category" placeholder="Category" required><br><br>
            <input type="text" name="NameDigitalAsset" placeholder="Name Digital Asset" required><br><br>
            <input type="text" name="Place" placeholder="Place" required><br><br>
            <input type="date" name="Date" placeholder="Date" required><br><br>
            <input type="time" name="Time" placeholder="Time" required><br><br>
            <input type="number" name="Quantity" placeholder="Quantity" required><br><br>
            <input type="number" name="Price" placeholder="Price ($)" required><br><br>
            <input type="hidden" name="Email" id="Email" required>
            <input type="hidden" name="Available" id="Available" value="true" required>
            <input type="submit" value="Add Asset" id="add-button" onclick="addAsset(event)">
        </form>
        <div class="conformation" style="display: none;">
            <p>Asset Added Successfully<br></p>
        </div>
    </div>

            <!-- end right forms -->

            <!-- start right form -->

            <div class="container right">
                <h1>Menu</h1>
                <div class="ProfilePic" id="ProfilePic">
                    <img src="images/adir.jpg" alt="ProfilePic">
                </div>
                <form id="assetFormRight" style="margin-top: 120px;">
                    <br><br><br><br><h2>Hi, Adir</h2>
                    <a class="choosed-button">Add New Digital Asset</a>
                    <a href="History.html" class="menu-button">Buy & Sell History</a>
                    <a href="Edit.html" class="menu-button">Edit Details</a>
                </form>
            </div>

      <!-- end right form -->
      <script src="https://static.elfsight.com/platform/platform.js" data-use-service-core defer></script>
      <div class="elfsight-app-9499548e-2fe2-4f40-910f-3ad318347df0" data-elfsight-app-lazy></div>
</body>

<script> // home page customer / admin

    // Retrieve the email from session storage
     const Email = sessionStorage.getItem('Email');
  
    // Determine the home page URL based on the user's role
    let homePageUrl;
    if (Email === null) { 
      homePageUrl = '/index'; // Set home page URL to '/index' when email is null
    } else if (Email === 'afik101297@gmail.com' || Email === 'adire7399@gmail.com') {
      homePageUrl = '/admin?Email=' + Email;
    } else {
      homePageUrl = '/customer?Email=' + Email;
    }
  
     // Set the href attribute of the home link
     const homeLink = document.getElementById('home-link');
     homeLink.setAttribute('href', homePageUrl);
  </script>


<script>


async function addAsset(event) {
  try {
    event.preventDefault(); // Prevent default button action (e.g., form submission)

    if (confirm('Are you sure you want to Add?')) {
      await createAsset(); // Create asset
    } else {
      // User canceled the action
      alert('Add Asset canceled.');
    }
  } catch (error) {
    console.error('Error adding asset:', error);
  }
}


async function createAsset() {
  try {
    const formData = new FormData(document.getElementById('assetForm'));
    
    const data = {};
    formData.forEach((value, key) => {
      data[key] = value;
    });

    // הוספת המייל מהסשן לגוף הבקשה
    data['Email'] = sessionStorage.getItem('Email');
    
    const response = await fetch('/addAsset', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(data)
    });

    if (!response.ok) {
      const errorMessage = await response.text();
      throw new Error(`Failed to create asset: ${errorMessage}`);
    }

    console.log('Asset created successfully');
    alert('Asset created successfully');
    location.reload(); // העלאה מחדש של העמוד

  } catch (error) {
    console.error('Error creating asset:', error);
  }
}



  </script>
  

</html>
